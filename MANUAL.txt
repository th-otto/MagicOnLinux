Remarks for Usage
=================

It is highly recommended to register the application and the MIME types to get full advantage
of the emulator. Not only some colourful icons will be shown for the emulator and Atari
programs in the host system, you also can run Atari programs by double click or context menu
from your host's file manager.

Floppy disk and other volume or disk images can be activated via drag&drop or via command line.
Only one image parameter is evaluated, and the accepted filename extensions are defined
in config.h (currently "st,raw-disk-image,img,fd,qd"). You can also pass them in your
file manager, either with double-click or with the context menu entry "Open with...".
The ".st" file type belongs to the Hatari emulator. See "install_mime_types.h" and run the
commands that are commented out, depending on if you have installed Hatari or not.

Drag&Drop of disk or volume images currently only assigns drives A: and B: and only mounts the
first primary partition of multi-partition images. To access multi-partition images you must
assign them in the config file.

If you for example specify "atari_drv_P" and "atari_drv_Q" with the same disk image file path,
the logical drive Q: will be the first usable partition, and P: will be the second one etc..
An MBR disk image may have up to four primary partitions. Secondary partitions are not supported, yet.

A logical drive like A: can be reassigned after an explicit eject (from MAGXDESK). If the drive
cannot be opened (due to wrong format e.g.), the emulator detects a failed mount attempt
(boot sector read, but nothing else read or written) and removes the logical drive so that
it can be reassigned.

In the config file, Atari memory size is given in bytes and excludes video memory which is handled
separately. On command line, the size can be specified in kbytes or Mbytes. Note that allocating
more than 14 MB is discouraged (see below).


Workarounds and Flaws
=====================

Due to a bug in MVDI and NVDI, the VT52 emulator draws graphics artifacts e.g. with CLR SCREEN,
visible in the MagiC task manager or if VT52.PRG is missing, when the screen width and
height are not dividable by the system character size (8x8 or 8x16).
To avoid this effect, the geometry is adjusted accordingly.

With no VT52.PRG, if starting a TOS program like MCMD, it takes a long time until the screen gets white.
This results from the MagiC kernel which used to work with slow floppy disk drives.

Contrary to other emulators, MagicOnLinux synchronises the mouse pointer positions of host and
emulated Atari. Unfortunately at least Signum 3 and 4 move the mouse pointer inside the Atari,
which then will be immediately moved back by the emulator. As workaround, a relative mouse
mode was introduced. It can be activated in the config file or via command line switch.
Note that in standard (i.e. absolute) mode, the mouse emulation key combinations
Alt-Cursor and Alt-Shift-Cursor must be emulated by the host. As side effect there will be no
keypress click sound then, contrary to Alt-Ins for emulation of the left mouse button.


Graphics Modes
==============

MVDI (MagiC VDI) is a stripped and slower sibling of NVDI, by the Behne Brothers.
These are the provided (M)VDI drivers:

- *.OSD are offscreen drivers and not hardware related
- *.NOD come from NVDI, they are faster than their OSD pendants.
  They are preferably loaded during boot process if they are found.
- MFA*.SYS are Atari hardware related and not used by MagicOnLinux or predecessors.
- MFM*.SYS are used by MagicOnLinux.
- NFM*.SYS come from NVDI, they are faster than their MFM pendants.
  They are not automatically loaded during boot, as the internal VDI
  explicitly opens e.g. MFM2.SYS in monochrome mode.
  It also seems that they are incompatible.

In particular:

- MFM2.SYS/NFM2.SYS:    monochrome mode (black/white)
- MFM4IP.SYS:           4 colours in 2 interleaved planes
- MFM16.SYS:            16 colours in 4 consecutive (?) planes
- MFM16IP.SYS:          16 colours in 4 interlaved planes
- MFM16M.SYS:           16 mio colours, 32-bit pixel packed, 24 from which are used
- MFM32K.SYS:           32768 colours, 16-bit pixel packed
- MFM256.SYS:           256 colours, 8-bit pixel packed

Note that the 16M and 32K graphics formats are direct, i.e. no colour palettes.
All other modes are indirect, with a colour palette of different length.

Note that 16M is recommended for MagicOnLinux. It is similar to the host
graphics format and thus leads to the best performance. Also the 256-colour
and monochrome modes are fast, because the colour representation is
suitable for the 68k emulation.

The IP formats are impractical for any kind of software and thus
are relatively slow. Maybe they are useful for specific Atari software.


Limitations
===========

Atari RAM size is limited to 2 GB, but, however, should be not larger than 14 MB.
Otherwise the address range 0x00e00000..0x01000000 will be normal RAM, and any
old or badly written program accessing the ST compatible I/O register range
will corrupt memory. For example, many programs write to address 0xfffffa42
to check for an installed 68881 FPU, and if they instead use the 24-bit address
0x00fffa42, they will undetectedly corrupt RAM.

In virtual drive U: the symbolic links are not updated when virtual drives are ejected or added.
This is a limitation or design flaw of the MagiC kernel, to be more precise: "DFS_U.S".

MagicOnLinux mounts MBR partitioned disk images and FAT volume images, but nothing with AHDI.
AHDI seems not to use MBR, but a proprietary format. As there are no AHDI disk images lying around,
a support would be unnecessary.

Secondary MBR partitions may be added later.

MagicOnLinux mounts floppy images in format ".st" (which is just a usual image), but
neither .stx nor .msa.

The .msa format (Magic Shadow Archiver) shall preserve copy-protection information. It can be converted
using "tools/hmsa" in the Hatari source directory (obviously by losing copy-protection data).
A standlone version can be found here:
https://web.archive.org/web/20060507110406/https://www.uni-ulm.de/~s_thuth/ix/msa-0.1.0.tar.gz

The .stx format also contains raw floppy disk data, to preserve copy-protection. It can be
read with Hatari. Hatari conveniently mounts host directories, so that files can be
easily copied from .stx or .msa as A: to a virtual drive C:.

In Ubuntu, most disk or volume images can be activated just by double-click. Note that the
"gnome-disk-image-mounter" must be run from command line with parameter "-w" or "--writable" to make the image writable.
However, it seems that at least not all ".st" images are accepted, maybe because of some details
in the boot sector that are not fully MS-DOS conformant.


This and That
=============

NVDI seems to freeze during start when ASSIGN.SYS is missing.

Network driver for Atari side: https://github.com/th-otto/magxnet/tree/master

Thanks to Thorsten Otto for the DFS_FAT FAT32 endianess bugfix (meta data on disk are always little-endian).


Create Volume images
====================

Consider we want to create a disk image of these dimensions:

- 512 bytes per sector
- 2 sectors per cluster
- FAT32
- verbose
- name "FAT32_1M"

Then these commands can be used:

dd if=/dev/zero of=vol-fat32-1M.img bs=1M count=1
mkfs.vfat -S 512 -s 2 -F 32 -v -n "FAT32_1M" vol-fat32-1M.img

Note that README.md lists an alternative solution that works without preceding "dd".


Atari Applications that seem to work (whitelist, alphabetically)
================================================

- 7UP 2.33PL8 [https://github.com/pulsar122/7UP-Editor]
- Arrow 1.1
- Artworx v1.42 (complains about missing GDOS, needs case-insensitive drive)
- CAB 1.5 (freeware)
- Chagall v01.00
- COPS [https://tho-otto.de/snapshots/cops/]
- Cypress v1.50
- FONTZ.PRG
- GEMBENCH 4.03
- Gempaint 1.3B2
- GEM2 Draw 2.0D (needs NVDI or GDOS)
- GEM2 GRAPH 1.0D
- GEM Output 1.2
- GenST (for MonST see below)
- Getinfo v1.1
- GFA-Basic Editor v3.77
- GSTASM (single-app mode)
- GSTFRAKT (single-app mode)
- Highwire (needs NVDI or GDOS)
- Intrface 2.30 [https://storage.atari-source.org/atari/mirrors/chapelie.rma.ac.be/atari/programming/]
- Krieg der Kerne (2/1987)
- Kubis (5/1992)
- LATTICE_C (single-app mode)
- MAPS (8+3 case-insensitive drive)
- MATRIX (naturally...)
- MODULA-2 (single-app mode)
- Omikron Basic 5.19
- ORCS 2.18 (but missing sharp-s)
- Papillon 3.0.4 (needs NVDI?)
- Papillon 2.2
- QED 5.0.5 [https://tho-otto.de/snapshots/qed/]
- Kobold?
- LDW Power Calc 1.03
- MagiC Configurator (needs case-insensitive drive)
- MonST (in ST-high, needs register access)
- Olga?
- Papyrus 4 (complains about missing fonts, needs case-insensitive drive)
- Papyrus 7 (complains about missing fonts)
- Phoenix 4.2 (some problems with file selector, remove MANAGER.INF, otherwise crash)
- Phoenix 5.0 (some problems with file selector, remove MANAGER.INF, otherwise crash)
- Prgflags
- Pure C
- Pure Pascal: run in single mode (hold Alt key during start)
- RCS28K (patched by Andreas Kromke)
- RCS.PRG 1.4
- RSM211E
- SCRAP.PRG
- Script (complains about missing fonts, needs case-insensitive drive)
- Script 2 (complains about missing fonts, needs case-insensitive drive)
- SIGNUM 2.00 (6.11.1987) runs in 640x400 monochrome in single-application mode.
- SIGNUM 2.01 (23.2.1988) runs in 640x400 monochrome in single-application mode.
- Technobox CAD/2 (needs case-insensitive drive)
- Texel 2.10
- Wordplus 2.02 UK
- Wordplus 3.20 TT UK



Atari applications that might work partially (greylist)
=======================================================

- CAD 3D 2.02 (seems to work in ST-high resolution)
- CAMCAD (works at least in 640x400 monochrome, should run in single-application mode)
- DR Doodle (corrupts memory blocks, repairable)
- Logo (corrupts memory blocks, repairable)
- Font Expert, FONTEX.PRG (might run in single application mode)
- RSCTEXT (direct video memory access, might work with 640x400)
- ST-Pascal (direct memory access, then bus error)
- GFABASIC 3.6 runs in single application mode in ST-high and ST-mid, otherwise total crash. Asks IKBD for Joystick status.
- Tempus Word <<<=== find out, what files is missing and cannot find


Atari applications that do not work at all (blacklist)
======================================================

- ALICE (overwrites memory)
- CAMPUS
- DBASE (why?)
- Easydraw (first complains about missing GDOS, but then crashes and overwrites memory)
- EASYRIDR
- GEM2 Wordchart (bus error)
- NRSC 2.4 (writing to I/O)
- Omicron Basic Compiler 3.06 (crash, and when ejecting "omikron_basic_compiler_3_06_omikron.st", system crashes)
- Omikron BASIC v3.60 (I/O access)
- PERSYS (draws artifacts like task manager in B/W)
- PLOT_IT.PRG (draws artifacts like task manager in B/W, then crashes)
- STAD_1_3.PRG (accesses video base register, needs case-insensitive drive, freezes system after crash)
- ST BASIC (bus error)
- ST LOGO (overwrites memory)
- Signum 3 (starts in monochrome, 2ip, 4ip, 8 bits, but messes mouse pointer)
- Scigraph (first complains about missing GDOS, then crashes with access to fffffa42, MC68881 FPU)
- SED_440
- SWFÅ”AK.PRG (system was overwritten)
- Tempus
- Tempus2 (access address 0xffff01)
- Wordplus (bus error. Why?)
- Wordplus 2 (bus error)


To test
=======

- Prolist (missing GDOS)
